---
title: "Documento RMarkdown del Seminario de Fuentes"
author: |
    **Daniel De Lara Pérez, Álvaro Velasco García, Gabriel Collado Santamaría**
date: "Curso 2022-2023"
output: 
  html_document:
    df_print: paged
    toc: true
    toc_float: true
  pdf_document:
    toc: yes
always_allow_html: true
---

## Introducción
Con este proyecto, pretendemos averiguar si existe algún tipo de relación estadística entre la muerte *no natural* de niños al nacer y la cantidad de ejercicio físico que llevan a cabo las mujeres embarazadas. Todo ello subcatalogado por Comunidades Autónomas.

Entre los métodos que proponemos para solucionar el problema planteado se encuntran:
Uso de pipelines para la concatenación de diferentes funciones, creación de objetos, la utilización de los joins para la combinación de diferentes tablas y encontrar un posible relación entre los dos cojuntos de datos,desarrollo de gráficos para poder visualizar mejor una posible relación entre los datos de interés,etc.

## Objetivos
- Recoger datos porcentuales acerca del número de muertes de niños con menos de una semana de vida por comunidad autónoma y su proporción con el número de niños nacidos en un año.
- Recoger datos sobre la cantidad de deporte practicado por comunidad autónoma entre     mujeres en edad fértil y tasarla en tres niveles porcentuales `alto` `moderado` `bajo`
- Estudiar si existe algún tipo de relación entre estos dos grupos.

## Materiales
Los datos utilizados en este estudio son:

- Defunciones de menores de una semana por causas (lista perinatal reducida), sexo y comunidad y ciudad autónoma de residencia del año 2021 - *Gobierno de España*
```{r message=FALSE}
library(readr)
Muerte_niños_semana <- read_delim("Input/data/Muerte_niños_semana.csv", 
                                  delim = ";", escape_double = FALSE, trim_ws = TRUE)
Muerte_niños_semana
```
- La Encuesta Nacional de Salud del año 2017- *Ministerio de Sanidad*
```{r message=FALSE}
library(readxl)
Encuesta_nacional_2017 <- read_excel("Input/data/Encuesta_nacional_2017.xlsx", 
                                     sheet = "Hoja1")
Encuesta_nacional_2017
```
- La natalidad de las Comunidades Autónomas del año 2021 - *Página web de DatosMacro*

Estos se han importado en formato Excel y CSV, para la Encuesta Nacional de Salud y las defunciones de menores de una semana respectivamente, ya que en algún caso éra la única alternativa para su importación.
Dentro de la Encuesta Nacional de Salud, se creo un Hoja de Excel que incluía solamente los datos del nivel de ejercicio de mujeres, a causa de la gran cantidad de datos que este archivo Excel presentaba.

En el caso de la Natalidad por comunidades autónomas se ha requerido la aplicación de la función `clipboard`, debido a que la descarga de datos no era accesible en ningún tipo de formato.

## Métodos y Tablas
```{r message=FALSE}
library(dplyr)
```
Realizamos el filtrado de los datos de niños muertos: Ambos sexos por CCAA
```{r message=FALSE}
x1 <- 
  Muerte_niños_semana %>%
  group_by(`Comunidades y Ciudades Autónomas`, Sexo) %>%
  select(Total) %>%
  summarise(
    suma_total = sum(Total)
  )


x2 <- na.omit(x1)

muertes_CCAA <- filter(x2, Sexo == "Ambos sexos")
```
```{r}
knitr::kable(
  head(muertes_CCAA[,1:3],19),
)
```
Ahora hacemos el filtrado de los datos correspondiente al grado de deporte: Mujeres por CCAA y su nivel de act.física
```{r}
ejercicio_mujeres_comunidad<-
  Encuesta_nacional_2017 %>%
  slice(.data=.,2:20) %>% 
  rename(
    tamaño_muestral=...2,nivel_alto=...3,nivel_moderado=...4,nivel_bajo=...5
  )
```
```{r}
knitr::kable(
  head(ejercicio_mujeres_comunidad[,1:5],19),
)
```
Vamos a proceder a la unión de ambas tablas:

- Primero vamos a forzar a que ambas bases de datos tengan los datos en el mismo       formato, es decir, en este caso uno presenta los characteres en minúsculas y el      otro en mayúsculas. Lo corregimos:
```{r}
muertes_CCAA$`Comunidades y Ciudades Autónomas`<- toupper(muertes_CCAA$`Comunidades y Ciudades Autónomas`)
muertes_CCAA
```
- Busco un atributo común a ambos set de datos
```{r}
attributes(muertes_CCAA)
attributes(ejercicio_mujeres_comunidad)
```
Sí que presentan un atributo común, pero no con el mismo nombre, uno se llama 
*Comunidades y Ciudades Autónomas* y el otro *Mujeres*.
De forma que vamos a cambiar el nombre de *MUJERES* del set de datos ejercicio_mujeres_comunidad por *Comunidades y Ciudades Autónomas* para que coincidan con el de el set de datos muertes_CCAA:
```{r}
ejercicio_mujeres_comunidad<-
  ejercicio_mujeres_comunidad %>% 
  rename( "Comunidades y Ciudades Autónomas" = MUJERES)
ejercicio_mujeres_comunidad
```
- Comprobamos los levels:
```{r}
levels(factor(muertes_CCAA$`Comunidades y Ciudades Autónomas`))
levels(factor(ejercicio_mujeres_comunidad$"Comunidades y Ciudades Autónomas"))
```
Observamos que en **Cataluña** la `ñ` está representada por otro caracter en muertes_CCAA. Corregimos eso:
```{r}
muertes_CCAA$`Comunidades y Ciudades Autónomas`[9]<-"CATALUÑA"
muertes_CCAA
```
- Ya podemos hacer un left join para unir ambas tablas sin que nos salga NA. En        realidad estaremos haciendo un natural join al no especificar las columnas a unir:
```{r message=FALSE}
union_tablas<-left_join(x=ejercicio_mujeres_comunidad,y=muertes_CCAA)
```
```{r}
knitr::kable(
  head(union_tablas[,1:7],19),
  caption = 'Ambas tablas unificadas'
)
```

Una vez pasadas las tablas a ser una sola, toca obtener los datos de los nacimientos por Comunidad Autónoma:
```{r}
Natalidad<-data.frame( `Comunidades y Ciudades Autónomas` =muertes_CCAA$`Comunidades y Ciudades Autónomas`,
                       
                       nacimientos=c(65522,9095,4771,9455,13178,3407,14738,13652,58464,843,35761,7380,15247,52357,962,13706,5036,14743,2318))
```
```{r}
knitr::kable(
  head(Natalidad[,1:2],19),
)
```
Hemos creado un nuevo dataframe **Natalidad** basándonos en los atributos de interés de natalidad por CCAA. Lo único que nos interesa es la columna de nacimientos.

Una vez obtenidos los datos del número de nacimientos por comunidad autónoma
creamos una nueva columna, que relacione la cantidad de niños muertos por
comunidad respecto la cantidad de nacimientos (también por comunidad) en porcentaje sobre 100.
```{r message=FALSE}
str(muertes_CCAA)
str(Natalidad)

muertes_CCAA<-
  left_join(muertes_CCAA,Natalidad,by=c("Comunidades y Ciudades Autónomas"="Comunidades.y.Ciudades.Autónomas")) %>% 
  mutate(.data = ., muertes_comunidad_porcentaje = (suma_total /nacimientos)*100)


union_tablas<-left_join(x=ejercicio_mujeres_comunidad,y=muertes_CCAA)
```
```{r}
knitr::kable(
  head(union_tablas[,1:9],19),
  caption = 'Tabla definitiva de relación'
)
```
Eliminamos dos columnas, innecesarias para realizar los gráficos
```{r}
union_tablas<- union_tablas[,-c(2,6)]
```

## Resultados (gráficos)

## Conclusiones

## Referencias
__Datos muerte niños:__

Instituto Nacional de Estadística, 2021,

Datos sobre la cantidad de muertes de niños menores de una semana por comunidad autónoma,

(https://datos.gob.es/es/catalogo/ea0010587-defunciones-de-menores-de-una-semana-por-causas-lista-perinatal-reducida-sexo-y-comunidad-y-ciudad-autonoma-de-residencia-ecm-identificador-api-t15-p417-a2020-l0-02022-px)


__Datos sobre el deporte:__

Ministerio de Sanidad, 2017,

Recopilación de datos sobre el deporte en españa,

(https://www.sanidad.gob.es/estadEstudios/estadisticas/encuestaNacional/encuestaNac2017/encuestaResDetall2017.htm)

__Datos de natalidad:__

Natalidad de las comunidades autónomas,

Datosmacro.com, 2021,

(https://datosmacro.expansion.com/demografia/natalidad/espana-comunidades-autonomas)